services:
  owner-app:
    build:
      context: .
      dockerfile: owner-app/Dockerfile
    container_name: cipherphantom-owner-app
    restart: unless-stopped
    environment:
      NODE_ENV: production
      OWNER_APP_HOST: 0.0.0.0
      OWNER_APP_PORT: "8787"
      OWNER_SESSION_TTL_HOURS: "12"
      OWNER_ALLOW_SERVER_REBOOT: "0"
      OWNER_IDS: "${OWNER_IDS:-72271934840903@lid}"
      OWNER_PUBLIC_BASE_URL: "${OWNER_PUBLIC_BASE_URL:-}"
      OWNER_APK_DOWNLOAD_URL: "${OWNER_APK_DOWNLOAD_URL:-}"
      OWNER_UPDATE_URL: "${OWNER_UPDATE_URL:-}"
      OWNER_APK_FILE: "${OWNER_APK_FILE:-/app/data/releases/latest.apk}"
    ports:
      - "127.0.0.1:8787:8787"
    volumes:
      - ./data:/app/data
      - ./owner-app/android:/app/owner-app/android:ro
      - /var/run/docker.sock:/var/run/docker.sock

  bot:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: cipherphantom-bot
    restart: unless-stopped
    depends_on:
      - owner-app
    environment:
      NODE_ENV: production
      OWNER_APK_AUTOBUILD: "0"
      OWNER_IDS: "${OWNER_IDS:-72271934840903@lid}"
    volumes:
      - ./data:/app/data
      - ./auth:/app/auth
